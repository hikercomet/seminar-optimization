# セミナー割当最適化ツール 完全実行マニュアル（重訂版）

以下は、セミナー割当最適化ツールの使用方法を初心者向けに簡潔にまとめたマニュアルデス。
Gitを使用したバージョン管理フローと、VS CodeのLive Share拡張機能を活用した共同作業手順を統合し、見やすく整理しま下。
セットアップから実行、結果確認までをステップごとに解説しマス。
大切なことを[[[[濃縮還元]]]]シマスタのでしっかり読んでくだサイ

---

## 📚 目次（クリックでジャンプ）

1. [ツールの概要](#1-ツールの概要)
2. [Gitを使用した初期設定](#2-gitを使用した初期設定)
3. [VS Code Live Shareで共同作業](#3-vs-code-live-shareで共同作業)
    3.1 [Live Shareとは](#31-live-shareとは)
    3.2 [Live Shareのインストールとセットアップ](#32-live-shareのインストールとセットアップ)
    3.3 [Live Shareの使い方](#33-live-shareの使い方)
4. [必要な準備](#4-必要な準備)
    4.1 [Pythonのインストール](#41-pythonのインストール)
    4.2 [ライブラリのインストール](#42-ライブラリのインストール)
    4.3 [日本語フォントのセットアップ](#43-日本語フォントのセットアップ)
5. [ファイル構成](#5-ファイル構成)
    5.5 [最適化アルゴリズムの詳細](#55-最適化アルゴリズムの詳細)
     5.5.1 [貪欲法＋局所探索](#551-貪欲法局所探索)
     5.5.2 [遺伝的アルゴリズム](#552-遺伝的アルゴリズム)
     5.5.3 [整数線形計画法（ILP）](#553-整数線形計画法ilp)
     5.5.4 [CP-SAT](#554-cp-sat)
     5.5.5 [多段階最適化](#555-多段階最適化)
     5.5.6 [適応型アルゴリズム](#556-適応型アルゴリズム)
6. [入力データの準備](#6-入力データの準備)
    6.1 [学生の希望データ](#61-学生の希望データ)
    6.2 [セミナー設定データ](#62-セミナー設定データ)
    6.3 [自動生成データの利用](#63-自動生成データの利用)
7. [ツールの実行手順](#7-ツールの実行手順)
    7.1 [コマンドでの実行](#71-コマンドでの実行)
    7.2 [GUIでの実行](#72-guiでの実行)
8. [結果の確認](#8-結果の確認)
    8.1 [出力ファイルの種類](#81-出力ファイルの種類)
    8.2 [結果の見方](#82-結果の見方)
9. [Gitを使用した作業フロー（重要）](#9-gitを使用した作業フロー重要)
10. [パラメータのカスタマイズ](#10-パラメータのカスタマイズ)
     10.1 [セミナー定員の設定](#101-セミナー定員の設定)
     10.2 [希望順位のスコア重み](#102-希望順位のスコア重み)
     10.3 [焼きなまし法の設定](#103-焼きなまし法の設定)
11. [トラブルシューティング](#11-トラブルシューティング)
12. [追加の便利機能](#12-追加の便利機能)
13. [貢献](#13-貢献)
14. [ライセンス](#14-ライセンス)

---

## 1. ツールの概要

このツールは、学生のセミナー希望と定員を考慮し、満足度を最大化する割当を計算しマス‼

* **アルゴリズム**
  貪欲法＋局所探索、遺伝的アルゴリズム、ILP、CP-SAT、多段階最適化、適応型アルゴリズムを搭載。
* **データ入力**
  JSONまたはCSV形式のデータ、または自動生成データを使用可能。
* **出力**
  CSVとPDFレポートで結果を提供。
* **カスタマイズ**
  試行回数、スコア重み、アルゴリズム選択を調整可能。
* **GUI**
  Tkinterベースで直感的に操作可能。

---

## 2. Gitを使用した初期設定

チームでコードやデータを共有する場合、Gitリポジトリを使用しマス‼
ortools==9.9.3963
pandas==2.2.2
reportlab==4.1.0
jsonschema==4.22.0
scikit-learn==1.5.0

* **リポジトリのクローン（初回のみ）**

  ```bash
  git clone https://github.com/hikercomet/seminar-optimization.git
  ```
* **作業フォルダに移動**

  ```bash
  cd seminar-optimization
  ```

---

## 3. VS Code Live Shareで共同作業

チームでリアルタイムにコードやデータを編集する場合、VS CodeのLive Share拡張機能が便利デス‼

### 3.1 [[[[Live Share]]]]とは

Live Shareは、複数人でリアルタイムに同じ開発環境を共有して作業できるツールデス‼❢‼
リモートでもファイル編集、デバッグ、ターミナル、サーバーを共有でき、まるで同じ部屋で作業しているような体験が可能デス‼

| 機能         | 説明                                           |
| ---------- | -------------------------------------------- |
| リアルタイム共同編集 | 同じコードを同時に編集。カーソル位置が色付きで表示され、誰がどこを編集しているか分かる。 |
| 共同デバッグ     | ブレークポイントや変数の確認をリアルタイムで共有。                    |
| 共有ターミナル    | ターミナルを共有してコマンド実行やビルドを一緒に行う。                  |
| サーバー共有     | ローカルサーバー（例: Webアプリ）のポートを参加者に公開。              |
| チャット機能     | テキストや音声チャットでコミュニケーション可能。                     |
| アクセス権限設定   | 編集権限や読み取り専用を細かく設定できる。                        |

**メリット**

* Gitのコミット・プッシュ・プルの待ち時間なしでリアルタイム共有。
* 相手の環境構築が不要（あなたの環境をそのまま共有）。
* リモートでのペアプログラミングがスムーズ。

---

### 3.2 Live Shareのインストールとセットアップ

* **拡張機能のインストール**

  1. VS Codeを開く。
  2. 左サイドバーの拡張機能アイコン（四角4つ）をクリック。
  3. 検索で「Live Share」を入力し、「Live Share」をインストール（「Live Share Extension Pack」は不要）。
  4. インストール後、必要に応じてVS Codeを再起動。

* **サインイン（初回のみ）**
  左下のLive Shareアイコン（双方向の矢印）をクリック。
  MicrosoftまたはGitHubアカウントでサインイン。

---

### 3.3 Live Shareの使い方

* **セッション開始**
  左下のLive Shareアイコンをクリック（またはコマンドパレットで「Live Share: Start Collaboration Session」）。
  共有用URLが表示される。

* **リンクを共有**
  URLをコピーし、メールやチャットで相手に送信。
  相手はリンクを開き、VS Codeで参加（Live Share拡張機能が必要）。

* **共同作業**
  同じファイルをリアルタイム編集。
  カーソルが色付きで表示され、誰がどこを編集しているか分かる。
  ターミナル、サーバー、デバッグも共有可能。

* **セッション終了**
  左下のLive Shareアイコンから「End Collaboration Session」を選択。

**注意事項**

* リンクは信頼できる相手にのみ共有（読み取り専用設定可）。
* インターネット接続が必要。
* 初回はテストセッションで操作に慣れるのがオススメデス‼

---

## 4. 必要な準備

### 4.1 Pythonのインストール

* **必要バージョン**
  Python 3.8以上。

* **インストール方法**

  * Windows: 公式サイトからダウンロードし、「Add Python to PATH」にチェック。
  * Mac: `brew install python`（Homebrewが必要）。
  * Linux: `sudo apt install python3`（Ubuntuの場合）。

* **確認**

  ```bash
  python --version
  # または
  python3 --version
  ```

---

### 4.2 ライブラリのインストール

```bash
pip install pandas numpy reportlab ortools
```

* pandas: データ処理
* numpy: 数値計算
* reportlab: PDF生成
* ortools: CP-SATやILPソルバーの利用

---

### 4.3 日本語フォントのセットアップ

PDFで日本語を表示するため、IPAexGothicフォントが必要デス‼

* ダウンロード: IPAexフォント公式サイトから **ipaexg.ttf** を入手。
* 配置: `seminar_optimization` フォルダに置く（`seminar_gui.py`と同じ階層）。

---

## 5. ファイル構成

作業フォルダ `seminar_optimization` に以下を配置しマス‼

```
seminar_optimization/
├── config/
│   └── config.json
├── data/
│   ├── seminars.json
│   ├── students.json
│   ├── seminars.csv
│   └── students.csv
├── optimizers/
│   ├── __init__.py
│   ├── adaptive_optimizer.py
│   ├── cp_sat_optimizer.py
│   ├── genetic_algorithm_optimizer.py
│   ├── greedy_ls_optimizer.py
│   ├── ilp_optimizer.py
│   ├── multilevel_optimizer.py
│   └── optimizer_service.py
├── seminar_optimization/
│   ├── __init__.py
│   ├── seminar_gui.py
│   ├── output_generator.py
│   └── utils.py
├── results/
│   ├── optimization_results_Greedy_LS_20240720_193000.pdf
│   └── optimization_results_Greedy_LS_20240720_193000.csv
└── gui_settings.ini
```

---

### 5.5 最適化アルゴリズムの詳細

複数の最適化アルゴリズムを搭載し、問題の特性に応じて選択可能デス‼
以下に仕組み・内容・メリット・デメリットをまとめマス。

#### 5.5.1 貪欲法＋局所探索（greedy\_ls\_optimizer.py）

* **仕組み**
  貪欲法で初期解を生成（各学生を希望順位の高いセミナーに割り当て）、
  その後焼きなまし法で局所探索を行いスコアを改善。

* **内容**

  * 初期解: 学生の希望順位に基づき、定員内で貪欲に割り当て。
  * 焼きなまし法: ランダムに割り当てを交換し、一定確率でスコアが低い解も受け入れ、局所最適解を回避。
  * パラメータ: `initial_temperature`（初期温度）、`cooling_rate`（冷却率）、`local_search_iterations`（反復回数）。

* **メリット**

  * 高速で初期解を生成。
  * 焼きなまし法により局所最適解を回避し、良好な解を得やすい。
  * 小～中規模の問題に適す。

* **デメリット**

  * 大規模問題では最適解に到達しにくい。
  * パラメータ調整が結果に大きく影響。

---

#### 5.5.2 遺伝的アルゴリズム（genetic\_algorithm\_optimizer.py）

* **仕組み**
  生物の進化を模倣。複数の割当（個体）を生成し、交叉、突然変異、選択を繰り返して最適解を探索。

* **内容**

  * 初期集団: ランダムな割当を複数生成。
  * 交叉: 2つの割当を組み合わせて新割当を生成。
  * 突然変異: ランダムに割当を変更。
  * 選択: スコアが高い割当を優先次世代へ。

* **メリット**

  * 広範な解空間を探索可能。
  * 複雑な制約や非線形問題に強い。

* **デメリット**

  * 計算コストが高い（特に大規模）。
  * パラメータ調整が必要。

---

#### 5.5.3 整数線形計画法（ILP, ilp\_optimizer.py）

* **仕組み**
  問題を線形方程式として定式化し、厳密な最適解を求める。内部でCP-SATソルバー使用。

* **内容**

  * 目的関数: 希望順位スコア総和最大化。
  * 制約: 1人1セミナー割当、定員制限。

* **メリット**

  * 理論的に最適解を保証。
  * 小規模問題に最適。

* **デメリット**

  * 大規模問題で計算時間増大。
  * 複雑制約の追加が難しい場合あり。

---

#### 5.5.4 CP-SAT（cp\_sat\_optimizer.py）

* **仕組み**
  Google OR-ToolsのCP-SATソルバー使用。制約充足問題として最適化。

* **内容**

  * 制約ベースで割当、定員、希望順位を定義。
  * 効率的な探索で高速解取得。

* **メリット**

  * 大規模問題でも比較的高速。
  * 複雑制約対応可能。

* **デメリット**

  * 最適解保証がない場合あり。
  * ソルバー設定が難しい。

---

#### 5.5.5 多段階最適化（multilevel\_optimizer.py）

* **仕組み**
  学生をクラスタリング後、小規模クラスタで最適化し、全体で局所探索。

* **内容**

  * クラスタリング: 希望パターンでグループ化。
  * 段階的最適化: 小クラスタ解決後全体調整。

* **メリット**

  * 大規模問題を効率処理。
  * 計算負荷軽減。

* **デメリット**

  * クラスタリング品質依存。
  * 全体最適性が損なわれる場合あり。

---

#### 5.5.6 適応型アルゴリズム（adaptive\_optimizer.py）

* **仕組み**
  問題特性に応じてアルゴリズムを動的選択・組合せ。

* **内容**

  * 初期分析で最適アルゴリズム選択。
  * 実行中にスコア停滞時、切り替え。

* **メリット**

  * 柔軟で幅広いデータ対応。

* **デメリット**

  * ロジック複雑。
  * 計算オーバーヘッド増。

---

## 6. 入力データの準備

### 6.1 学生の希望データ

* 場所: `seminar_optimization/data/`（`students.json` または `students.csv`）

* **CSV例 (students.csv)**

```csv
student_id,preference1,preference2,preference3
1,a,c,e
2,b,d,f
3,a,g,k
4,c,a,b
```

* **JSON例 (students.json)**

```json
[
  {"student_id": 1, "preferences": ["a", "c", "e"]},
  {"student_id": 2, "preferences": ["b", "d", "f"]}
]
```

---

### 6.2 セミナー設定データ

* 場所: `seminar_optimization/data/`（`seminars.json` または `seminars.csv`）

* **JSON例 (seminars.json)**

```json
{
  "seminars": ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q"],
  "magnification": {"a": 2.0, "d": 3.0, "m": 0.5, "o": 0.25},
  "min_size": 5,
  "max_size": 10,
  "num_students": 112,
  "q_boost_probability": 0.2,
  "num_patterns": 200000,
  "max_workers": 8,
  "local_search_iterations": 500,
  "initial_temperature": 1.0,
  "cooling_rate": 0.995,
  "preference_weights": {"1st": 5.0, "2nd": 2.0, "3rd": 1.0},
  "algorithm": "greedy_ls"
}
```

* 主な項目:

  * `seminars`: セミナー名リスト
  * `min_size`, `max_size`: 各セミナーの定員範囲
  * `num_students`: 学生数
  * `num_patterns`: 試行回数
  * `preference_weights`: 希望順位のスコア
  * `algorithm`: 使用アルゴリズム（例: `greedy_ls`, `genetic`, `cp_sat`）

---

### 6.3 自動生成データの利用

* 自分でデータを用意しない場合、ツールがランダムデータを生成しマス‼
* GUIまたはコマンド実行時に「自動生成されたデータを使用」を選択。

---

## 7. ツールの実行手順

### 7.1 コマンドでの実行

* 最新コードを取得

```bash
git pull origin main
```

* フォルダにLive Shareで


入った状態で実行可能

```bash
python seminar_optimization/optimizer_service.py
```

* 実行中に設定ファイルやパラメータ変更可

---

### 7.2 GUIでの実行

* GUIファイルを起動

```bash
python seminar_optimization/seminar_gui.py
```

* GUI画面で

  * 入力ファイル（学生希望・セミナー情報）指定
  * アルゴリズム選択
  * パラメータ設定
  * 「最適化実行」ボタンを押す

---

## 8. 結果の確認

### 8.1 出力ファイル（`results/`）

| ファイル例                                                   | 内容                |
| ------------------------------------------------------- | ----------------- |
| optimization\_results\_Greedy\_LS\_20240720\_193000.csv | スコア推移（反復回数とスコア）   |
| optimization\_results\_Greedy\_LS\_20240720\_193000.pdf | 最終レポート（スコアグラフ・割当） |
| best\_assignment\_Greedy\_LS\_20240720\_193000.csv      | 学生ごとの割当詳細         |

---

### 8.2 結果の見方

* CSVはエクセルなどで開き、割当やスコア推移を確認。
* PDFはグラフや表が見やすくまとめられており、報告資料に最適。

---

## 9. Gitを使用した作業フロー（重要）

```bash
# 最新コード取得
git pull origin main

# 編集（例: students.jsonを編集）

# 変更をステージング
git add .

# 変更コミット
git commit -m "Update student preferences"

# 変更をリモートにプッシュ
git push origin main
```

* 共同作業はLive Shareでリアルタイム共有が便利デス‼

---

## 10. パラメータのカスタマイズ

### 10.1 セミナー定員

* `min_size`, `max_size`を設定し、各セミナーの定員を調整

### 10.2 希望順位スコア

* `preference_weights`の値で1位・2位・3位のスコア重みを調整

### 10.3 焼きなまし法パラメータ

* `initial_temperature`（初期温度）
* `cooling_rate`（温度の冷却率）
* `local_search_iterations`（局所探索の試行回数）

---

## 11. トラブルシューティング

| 問題               | 対策                                           |
| ---------------- | -------------------------------------------- |
| モジュールが見つからない     | `pip install`で必要なパッケージを再インストール               |
| PDFに日本語が表示されない   | `ipaexg.ttf`の配置を確認                           |
| 実行が遅い            | `num_patterns`や`local_search_iterations`を減らす |
| Live Share接続できない | ネットワーク環境・ファイアウォール設定を確認                       |

---

## 12. 追加の便利機能

* **自動データ生成**で素早くテスト可能
* **Slack通知**の連携検討中
* 複数アルゴリズムを比較実行し最適解を探索可能

---

## 13. 貢献

* Fork→ブランチ作成→編集→プルリクエストで貢献歓迎‼
* せめてこの文章を目が腐るまで読んでほしい…
* 今の現状プログラムの最適化がまだ（ゆうてしてあるがなぜか重い）
---

## 14. ライセンス

* MITライセンスデス。自由に利用・改変・再配布可能。
